---
layout: document
title: Tag
permalink: /tag/
public: true
---
<div>
    <ul id="tag-list" class="tag-list"></ul>
</div>

<div id="tag-collection"></div>

<script src="/js/axios.min.js"></script>
<script>
    ;(function() {
        axios.get(`/data/tag_count.json`, {})
            .then((resp) => {
                if (resp == null || resp.data == null) {
                    return;
                }
                const tags = resp.data;

                let template = '';
                for (let i = 0; i < tags.length; i++) {
                    const tag = tags[i];
                    template += `
                    <li class="tag-item">
                        <a href="#${tag.name}" onclick="showTag('${tag.name}')">${tag.name}<sup>${tag.size}</sup></a>
                    </li>`
                }
                document.getElementById('tag-list').innerHTML = template;

                showInitTag();
            });
    })();

    /*
     * 주어진 태그에 해당하는 모든 문서의 목록을 보여줍니다.
     */
    function showTag(tagName) {
        axios.get(`/data/tag/${tagName}.json`, {})
            .then((resp) => createLinks(resp, tagName));
    }

    /*
     * 주어진 태그에 해당하는 모든 문서의 링크를 만들어 줍니다.
     */
    function createLinks(resp, tagName) {
        if (resp == null || resp.data == null) {
            return;
        }

        const documents = Array.isArray(resp.data) ? resp.data : [];
        if (documents.length === 0) {
            document.getElementById('tag-collection').innerHTML = `
                <h3>${tagName}</h3>
                <p>문서가 없습니다.</p>`;
            return;
        }

        const listItems = documents
            .map((d) => {
                const href = (typeof d.url === 'string' && d.url.length > 0) ? d.url : '#';
                const title = d.title || '(제목 없음)';
                const updated = d.updated || '';
                const updatedDate = d.updatedDate || '';
                const summaryText = (d.summary == null || /^\s*$/.test(d.summary))
                    ? ''
                    : `-${d.summary}`;
                const childrenCount = Number(d.childrenCount || 0);
                const subDocument = childrenCount > 0
                    ? `- 서브 문서: ${childrenCount} 개`
                    : '';

                return `
                    <li>
                        <a class="post-link" href="${href}">
                            <span>${title}</span>
                            <div class="post-meta" style="float: right;" title="${updated}">${updatedDate}</div>
                            <div class="post-excerpt">${summaryText}</div>
                            <div class="post-sub-document">${subDocument}</div>
                        </a>
                    </li>`;
            })
            .join('');

        document.getElementById('tag-collection').innerHTML = `
            <h3>${tagName}</h3>
            <ul class="post-list">${listItems}</ul>`;
    }

    function showInitTag() {
        const url = window.location.href;
        const req = /#([^\s]+)$/.exec(url);
        if(Array.isArray(req)) {
            let tagName = decodeURI(req.pop());
            showTag(tagName);
        }
    }
</script>
